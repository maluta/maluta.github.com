---
layout: post
title: Notify chain example 1
tags: [oldblog]
---

<small>[Warning: This post is a backup recovery from my previous Wordpress blog. All content was automatically converted accessing a MySQL database using a Python script (<a href="http://maluta.github.io/blog/convert-wordpress-to-jekyll/">details</a>). Mostly are in Portuguese but if you are interest I can translate to English. If you found any problem dont't hesitate to contact me in comments.]</small>



<p style="text-align: justify;">This is a basic skeleton of a Linux kernel module about <em>notify chain</em> that I'll put as examples on my final course paper.When user presses a key, kernel "reads" it and then, using notify chain informs all subsystems which want to be informed about pressed key.</p>

<pre><span style="color: #444444;">/* keyboard-dump.c
 *
 * This is a "notify chain" example that dumps keyboard on kernel message
 *
 *	(C) Copyright 2010, Tiago Maluta
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */</span>

<span style="color: #0000ff;"><strong>#include <span style="color: #008000;">&lt;linux/notifier.h&gt;</span></strong></span>
<span style="color: #0000ff;"><strong>#include <span style="color: #008000;">&lt;linux/module.h&gt;</span></strong></span>
<span style="color: #0000ff;"><strong>#include <span style="color: #008000;">&lt;linux/keyboard.h&gt;</span></strong></span>

<strong>static</strong> <strong>int</strong> <span style="color: #2040a0;">debug</span> <span style="color: #4444ff;">=</span> <span style="color: #ff0000;">1</span><span style="color: #4444ff;">;</span>

<span style="color: #0000ff;"><strong>#define dbg(fmt, arg...)						\</strong></span>
	<strong>do</strong> <span style="color: #4444ff;"><strong>{</strong></span>								\
		<strong>if</strong> <span style="color: #4444ff;">(</span><span style="color: #2040a0;">debug</span><span style="color: #4444ff;">)</span>						\
			<span style="color: #2040a0;">printk</span> <span style="color: #4444ff;">(</span><span style="color: #2040a0;">KERN_DEBUG</span> <span style="color: #008000;">"%s: %s: "</span> <span style="color: #2040a0;">fmt</span> <span style="color: #008000;">"<span style="color: #77dd77;">\n</span>"</span>,		\
				<span style="color: #008000;">"test"</span> , <span style="color: #2040a0;">__FUNCTION__</span> , ## <span style="color: #2040a0;">arg</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>	\
	<span style="color: #4444ff;"><strong>}</strong></span> <strong>while</strong> <span style="color: #4444ff;">(</span><span style="color: #ff0000;">0</span><span style="color: #4444ff;">)</span>

<strong>int</strong> <span style="color: #2040a0;">keyboard_event_handler</span><span style="color: #4444ff;">(</span><strong>struct</strong> <span style="color: #2040a0;">notifier_block</span> <span style="color: #4444ff;">*</span><span style="color: #2040a0;">self</span>,
                         <strong>unsigned</strong> <strong>long</strong> <span style="color: #2040a0;">val</span>,
			 <strong>void</strong> <span style="color: #4444ff;">*</span><span style="color: #2040a0;">data</span><span style="color: #4444ff;">)</span> 

<span style="color: #4444ff;"><strong>{</strong></span>

	<strong>struct</strong> <span style="color: #2040a0;">keyboard_notifier_param</span> <span style="color: #4444ff;">*</span><span style="color: #2040a0;">param</span> <span style="color: #4444ff;">=</span> <span style="color: #2040a0;">data</span><span style="color: #4444ff;">;</span> 

	<strong>unsigned</strong> <strong>int</strong> <span style="color: #2040a0;">value</span> <span style="color: #4444ff;">=</span> <span style="color: #2040a0;">param</span><span style="color: #4444ff;">-</span><span style="color: #4444ff;">&gt;</span><span style="color: #2040a0;">value</span><span style="color: #4444ff;">;</span>

	<strong>if</strong> <span style="color: #4444ff;">(</span><span style="color: #4444ff;">(</span><span style="color: #4444ff;">!</span><span style="color: #2040a0;">param</span><span style="color: #4444ff;">-</span><span style="color: #4444ff;">&gt;</span><span style="color: #2040a0;">down</span><span style="color: #4444ff;">)</span> <span style="color: #4444ff;">&amp;</span><span style="color: #4444ff;">&amp;</span> <span style="color: #4444ff;">(</span><span style="color: #2040a0;">value</span> <span style="color: #4444ff;">&gt;</span> <span style="color: #ff0000;">0xf000</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">)</span>
		<span style="color: #2040a0;">printk</span><span style="color: #4444ff;">(</span><span style="color: #008000;">"%c"</span>, <span style="color: #2040a0;">KVAL</span><span style="color: #4444ff;">(</span><span style="color: #2040a0;">param</span><span style="color: #4444ff;">-</span><span style="color: #4444ff;">&gt;</span><span style="color: #2040a0;">value</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>

	<strong>return</strong> <span style="color: #2040a0;">NOTIFY_DONE</span> <span style="color: #4444ff;">;</span>
<span style="color: #4444ff;"><strong>}</strong></span>

<strong>static</strong> <strong>struct</strong> <span style="color: #2040a0;">notifier_block</span> <span style="color: #2040a0;">keyboard_notifier</span> <span style="color: #4444ff;">=</span> <span style="color: #4444ff;"><strong>{</strong></span>

	.<span style="color: #2040a0;">notifier_call</span> <span style="color: #4444ff;">=</span> <span style="color: #2040a0;">keyboard_event_handler</span>,
<span style="color: #4444ff;"><strong>}</strong></span><span style="color: #4444ff;">;</span>

<strong>static</strong> <strong>int</strong> <span style="color: #2040a0;">__init</span> <span style="color: #2040a0;">keyboard_init</span><span style="color: #4444ff;">(</span><strong>void</strong><span style="color: #4444ff;">)</span> 

<span style="color: #4444ff;"><strong>{</strong></span>

	<span style="color: #2040a0;">register_keyboard_notifier</span><span style="color: #4444ff;">(</span><span style="color: #4444ff;">&amp;</span><span style="color: #2040a0;">keyboard_notifier</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>

	<span style="color: #2040a0;">dbg</span><span style="color: #4444ff;">(</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>

	<strong>return</strong> <span style="color: #ff0000;">0</span><span style="color: #4444ff;">;</span>
<span style="color: #4444ff;"><strong>}</strong></span>

<strong>static</strong> <strong>void</strong> <span style="color: #2040a0;">__exit</span> <span style="color: #2040a0;">keyboard_exit</span><span style="color: #4444ff;">(</span><strong>void</strong><span style="color: #4444ff;">)</span>

<span style="color: #4444ff;"><strong>{</strong></span>
	<span style="color: #2040a0;">unregister_keyboard_notifier</span><span style="color: #4444ff;">(</span><span style="color: #4444ff;">&amp;</span><span style="color: #2040a0;">keyboard_notifier</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>
	<span style="color: #2040a0;">dbg</span><span style="color: #4444ff;">(</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>
<span style="color: #4444ff;"><strong>}</strong></span>

<span style="color: #2040a0;">module_init</span><span style="color: #4444ff;">(</span><span style="color: #2040a0;">keyboard_init</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>
<span style="color: #2040a0;">module_exit</span><span style="color: #4444ff;">(</span><span style="color: #2040a0;">keyboard_exit</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span>

<span style="color: #2040a0;">MODULE_LICENSE</span><span style="color: #4444ff;">(</span><span style="color: #008000;">"GPL"</span><span style="color: #4444ff;">)</span><span style="color: #4444ff;">;</span></pre>
<div id="_mcePaste" style="position: absolute; left: -10000px; top: 0px; width: 1px; height: 1px; overflow: hidden;">
<pre id="line1">&lt;<span class="start-tag">body</span><span class="attribute-name"> bgcolor</span>=<span class="attribute-value">"#ffffff" </span><span class="attribute-name">text</span>=<span class="attribute-value">"#000000"</span>&gt;
&lt;<span class="start-tag">pre</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#444444"</span>&gt;/* keyboard-dump.c
 *
 * This is a &amp;<span class="entity">quot;</span>notify chain&amp;<span class="entity">quot;</span> example that dumps keyboard on kernel message
 *
 *	(C) Copyright 2010, Tiago Maluta
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */&lt;/<span class="end-tag">font</span>&gt;

&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#0000ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;#include &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">lt;</span>linux/notifier.h&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line21">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#0000ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;#include &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">lt;</span>linux/module.h&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#0000ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;#include &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">lt;</span>linux/keyboard.h&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;

&lt;<span class="start-tag">strong</span>&gt;static&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;int&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;debug&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;=&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#ff0000"</span>&gt;1&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line25">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#0000ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;#define dbg(fmt, arg...)						\&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;
	&lt;<span class="start-tag">strong</span>&gt;do&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;{&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;								\
		&lt;<span class="start-tag">strong</span>&gt;if&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;debug&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;						\
			&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;printk&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;KERN_DEBUG&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">quot;</span>%s: %s: &amp;<span class="entity">quot;</span>&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;fmt&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">quot;</span>&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#77dd77"</span>&gt;\n&lt;/<span class="end-tag">font</span>&gt;&amp;<span class="entity">quot;</span>&lt;/<span class="end-tag">font</span>&gt;,		\
				&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">quot;</span>test&amp;<span class="entity">quot;</span>&lt;/<span class="end-tag">font</span>&gt; , &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;__FUNCTION__&lt;/<span class="end-tag">font</span>&gt; , ## &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;arg&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;	\
	&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;}&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">strong</span>&gt;while&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#ff0000"</span>&gt;0&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line32">
&lt;<span class="start-tag">strong</span>&gt;int&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_event_handler&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">strong</span>&gt;struct&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;notifier_block&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;*&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;self&lt;/<span class="end-tag">font</span>&gt;,
                         &lt;<span class="start-tag">strong</span>&gt;unsigned&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;long&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;val&lt;/<span class="end-tag">font</span>&gt;,
			 &lt;<span class="start-tag">strong</span>&gt;void&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;*&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;data&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line38">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;{&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;

	&lt;<span class="start-tag">strong</span>&gt;struct&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_notifier_param&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;*&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;param&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;=&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;data&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt; 

	&lt;<span class="start-tag">strong</span>&gt;unsigned&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;int&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;value&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;=&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;param&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;-&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;value&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line43">	&lt;<span class="start-tag">strong</span>&gt;if&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;!&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;param&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;-&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;down&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">amp;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">amp;</span>&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;value&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#ff0000"</span>&gt;0xf000&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;
		&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;printk&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">quot;</span>%c&amp;<span class="entity">quot;</span>&lt;/<span class="end-tag">font</span>&gt;, &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;KVAL&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;param&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;-&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">gt;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;value&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line46">	&lt;<span class="start-tag">strong</span>&gt;return&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;NOTIFY_DONE&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;}&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;

&lt;<span class="start-tag">strong</span>&gt;static&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;struct&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;notifier_block&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_notifier&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;=&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;{&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line51">	.&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;notifier_call&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;=&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_event_handler&lt;/<span class="end-tag">font</span>&gt;,
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;}&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;

&lt;<span class="start-tag">strong</span>&gt;static&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;int&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;__init&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_init&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">strong</span>&gt;void&lt;/<span class="end-tag">strong</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line55">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;{&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;

	&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;register_keyboard_notifier&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">amp;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_notifier&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
	&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;dbg&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line61">	&lt;<span class="start-tag">strong</span>&gt;return&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#ff0000"</span>&gt;0&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;}&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">strong</span>&gt;static&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">strong</span>&gt;void&lt;/<span class="end-tag">strong</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;__exit&lt;/<span class="end-tag">font</span>&gt; &lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_exit&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">strong</span>&gt;void&lt;/<span class="end-tag">strong</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line65">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;{&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;
	&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;unregister_keyboard_notifier&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&amp;<span class="entity">amp;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_notifier&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
	&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;dbg&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;&lt;<span class="start-tag">strong</span>&gt;}&lt;/<span class="end-tag">strong</span>&gt;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line69">&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;module_init&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_init&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;
&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;module_exit&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;keyboard_exit&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;

&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#2040a0"</span>&gt;MODULE_LICENSE&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;(&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#008000"</span>&gt;&amp;<span class="entity">quot;</span>GPL&amp;<span class="entity">quot;</span>&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;)&lt;/<span class="end-tag">font</span>&gt;&lt;<span class="start-tag">font</span><span class="attribute-name"> color</span>=<span class="attribute-value">"#4444ff"</span>&gt;;&lt;/<span class="end-tag">font</span>&gt;</pre>
<pre id="line74">&lt;/<span class="end-tag">pre</span>&gt;</pre>
</div>
The output will be visible (i.e: dmesg) on kernel ring buffer.

If you like try<strong> don't</strong> cut&amp;paste the code above but use I gist repository <a href="http://gist.github.com/373206" target="_blank">here</a>.